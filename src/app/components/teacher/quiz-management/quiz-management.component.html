<!-- Import any necessary Angular modules at the top of your file -->
<body class="flex flex-col p-6 bg-gray-100">
  <div class="flex items-center justify-between mx-4">
    <div class="flex w-auto">
      <button
  class="flex items-center poppins-b shadow-sm text-lg rounded-lg px-3 py-1.5 bg-transparent gradient-green-purple-blue hover:scale-105 hover:ease-out duration-300"
        (click)="navigateBack()"
      >
        Back
      </button>
    </div>
    <!-- Quiz Operations Buttons -->
    <div>
      <button
        (click)="navigateAnal()"
        class="font-bold poppins-b shadow-sm px-3 py-1.5 rounded-md text-lg bg-transparent gradient-green-purple-blue hover:scale-105 hover:ease-out duration-300"
      >
        ANALYTICS
      </button>
      <button
        (click)="createQuiz()"
        class="ml-2 font-bold poppins-b shadow-sm px-3 py-1.5 rounded-md text-lg bg-transparent gradient-green-purple-blue hover:scale-105 hover:ease-out duration-300"
      >
        <i class="mr-2 fas fa-plus"></i> CREATE QUIZ
      </button>
    </div>
  </div>


  <!-- Main Container -->
  <div class="flex flex-col items-center justify-start w-full gap-3 mt-4">
    <!-- Left Column - Quiz Management -->
    <div class="w-full p-4 bg-white rounded-md shadow-md">
      <div class="flex flex-col mb-5">
        <div class="flex justify-center mb-4 rounded-lg backgroundQuiz">
          <h2 class="text-2xl font-bold text-center text-white py-2.5">
            QUIZ MANAGEMENT
          </h2>
        </div>
        <div class="mb-2.5">
          <div class="relative inline-block text-left">
            <button
              type="button"
              (click)="toggleDropdown()"
              class="inline-flex justify-center w-full px-4 py-2 text-base font-medium bg-white border border-gray-300 rounded-md shadow-sm md:w-auto md:text-sm lg:text-base gradient-green-purple-blue hover:scale-105"
            >
              {{
                currentCourse == null ? "Select Course" : currentCourse.title
              }}
            </button>
            <div
              *ngIf="isDropdownOpen"
              class="absolute right-0 w-full mt-2 overflow-hidden origin-top-right bg-white rounded-md shadow-lg md:max-w-xs lg:max-w-md ring-1 shadowboxz ring-black ring-opacity-5"
            >
              <div
                class="py-1"
                role="menu"
                aria-orientation="vertical"
                aria-labelledby="options-menu"
              >
                <button
                  *ngFor="let course of courses"
                  (click)="changeCourse(course)"
                  class="block px-4 py-2 text-sm gradient-green-purple-blue hover:bg-gray-100 hover:text-gray-900"
                  role="menuitem"
                >
                  {{ course.title }}
                </button>
              </div>
            </div>
          </div>
          
        </div>

        <!-- Quiz List Table -->
        <div class="w-full overflow-x-auto">
          <table
            class="w-full text-sm border border-gray-300 poppins md:text-base lg:text-lg"
          >
            <thead
              class="poppins-b gradient-text"
            >
              <tr>
                <th class="px-4 py-2 border border-gray-300">Quiz Title</th>
                <th class="px-4 py-2 border border-gray-300">Created On</th>
                <th class="px-4 py-2 border border-gray-300">Items</th>
                <th class="px-4 py-2 border border-gray-300">Deadline</th>
                <th class="px-4 py-2 border border-gray-300">Time Limit</th>
                <th class="px-4 py-2 border border-gray-300">Actions</th>
              </tr>
            </thead>
            <tbody class="text-gray-400">
              <!-- Quiz List Rows Go Here -->
              <ng-container *ngFor="let quiz of quizzes">
                <tr
                  [ngClass]="{
                    'bg-slate-200': quiz.id == selectedQuiz?.id
                  }"
                  (click)="getAverageScore(quiz)"
                  class="cursor-pointer active:bg-slate-200 hover:bg-slate-100"
                  *ngIf="
                    currentCourse == null
                      ? true
                      : currentCourse.id == quiz.courseid
                  "
                >
                  <td class="px-4 py-2 border border-gray-300">
                    {{ quiz.title }}
                  </td>
                  <td class="px-4 py-2 border border-gray-300">
                    {{ parseDate(quiz.time) }}
                  </td>
                  <td class="px-4 py-2 border border-gray-300">
                    {{ quiz.items }}
                  </td>
                  <td class="px-4 py-2 border border-gray-300">
                    {{ parseDate(quiz.deadline) }}
                  </td>
                  <td class="px-4 py-2 border border-gray-300">
                    {{ quiz.timelimit }}
                    {{ quiz.timelimit == 1 ? "min" : "mins" }}.
                  </td>

                  <td class="px-4 py-2 border border-gray-300">
                    <button (click)="editQuiz(quiz)" class="px-4 py-2 text-white bg-green-600 rounded hover:bg-green-500">
                      Edit
                    </button>
                  </td>
                </tr>
              </ng-container>
              <!-- Repeat for each quiz -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Right Column - Quiz Analytics and Feedback -->
      <div class="w-full h-auto rounded-md">
        <!-- Quiz Analytics Section -->
        <div class="flex justify-center rounded-lg backgroundQuiz">
          <h2 class="text-2xl font-bold text-center text-white py-2.5">
            QUIZ ANALYTICS
          </h2>
        </div>
        <!-- Feedback Section -->
        <p
          class="poppins-b gradient-text text-2xl py-2.5 mb-2 mt-3.5"
        >
          Average Score:
          <span>{{
            gettingAvg
              ? "Calculating..."
              : (mockAverageScore * 100).toString() + "%"
          }}</span>
        </p>
        <div class="relative inline-block mb-4 text-left">

          <input
            readonly
            type="text"
            [(ngModel)]="
              selectedQuiz == null ? 'Select a Quiz Above' : selectedQuiz.title
            "
            (input)="filterQuizzes()"
            placeholder="Enter Quiz Name"
            class="poppins w-full rounded-md px-2.5 py-2 text-sm gradient-text border border-gray-300"
          />

        </div>

        <div class="relative inline-block mb-4 ml-2 text-left">

          <input
            [readOnly]="selectedStudent != null"
            type="text"
            [(ngModel)]="search"
            (input)="searchPeople($event)"
            placeholder="Search Student Name"
            class="poppins w-full rounded-md px-2.5 py-2 text-sm gradient-green-purple-blue border border-gray-300"
          />
        </div>
        <span
          (click)="resetStudent()"
          *ngIf="selectedStudent != null"
          class="px-2 ml-2 bg-red-600 rounded cursor-pointer"
          ><i class="text-white bx bx-x"></i
        ></span>
        <ng-container *ngIf="!searching; else searchs">
          <div *ngIf="people.length" class="flex-grow">
            <p class="mb-3 leading-9">
              <span
                (click)="selectStudent(person)"
                class="select-none cursor-pointer px-2 py-1 hover:!bg-blue-200 bg-blue-100 rounded-md ml-2"
                *ngFor="let person of people; let i = index"
              >
                {{ person.firstname + " " + person.lastname }}
                <span class="px-2 text-white bg-blue-400 rounded"
                  >{{ person.takenpoints }}/{{ person.totalpoints }}</span
                >
              </span>
            </p>
          </div>

          <ng-container
            *ngIf="
              !people.length &&
              search.trim() != '' &&
              selectedStudent == null &&
              selectedQuiz != null
            "
          >
            <div class="mb-2 ml-2">
              No related search for students who took the quiz
            </div>
          </ng-container>

          <ng-container
            *ngIf="
              !people.length &&
              search.trim() != '' &&
              selectedStudent == null &&
              selectedQuiz == null
            "
          >
            <div class="mb-2 ml-2">Please select a quiz in the table</div>
          </ng-container>
        </ng-container>
        <ng-template #searchs>
          <div class="flex-grow">
            <p class="mb-3 ml-3 leading-9">Searching....</p>
          </div>
        </ng-template>
        <div class="h-full">
          <textarea
            [(ngModel)]="feedback"
            class="poppins text-sm w-full px-2.5 py-2 border border-gray-300 rounded-md mb-3.5"
            placeholder="Write feedback..."
          ></textarea>
        </div>
        <!-- Send Button -->
        <div class="flex items-center justify-center">
          <button
            (click)="sendFeedback()"
            class="px-4 py-2 duration-300 bg-transparent rounded-md shadow-md poppins-b gradient-green-purple-blue hover:scale-105 hover:ease-out hover:bg-blue-600"
          >
            Send
          </button>
        </div>
      </div>
    </div>
  </div>
</body>
